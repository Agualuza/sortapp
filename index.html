<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>SortApp</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline';" />

	<!-- Bootstrap CSS -->
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
	<script src="./js/jquery3.min.js"></script>
	<script src="./js/jquery-swapsies.min.js" type="text/javascript"></script>

	<link rel="stylesheet" href="./css/style.css" />
</head>
<body>
	<div id="div-main" class="container">
		<div class="row flex-a col-12"> 
			<div class="">
				<img src="./images/sortapp.png" class="img-fluid">
			</div>
		</div>

		<div class="row flex-a col-12"> 
		   <div class="card col-12" style="width: 12rem; height: 4rem; background-color:#2b2d3b;border:none;">
		   		<div class="input-group mb-3">
				  <div class="input-group-prepend">
				    <span class="input-group-text" id="inputGroup-sizing-default">Números</span>
				  </div>
				  <input type="text" class="form-control" id="numbers-input" placeholder="Ex: 1,3,4,5,2,6,8,7" aria-label="Sizing example input" aria-describedby="inputGroup-sizing-default">
				</div>
		   </div>
		</div>
		<div class="row flex-a col-12"> 
			<span class="select-title">Selecione o algoritmo<span>
		</div>
		<div class="row flex-a col-12"> 
			<div class="col-3">
				<a onclick="clicked(1)"><img id="img-bubble" src="./images/bubble.png" class="img-fluid"></a>
			</div>
			<div class="col-3">
				<a onclick="clicked(2)"><img id="img-merge" src="./images/merge.png" class="img-fluid"></a>
			</div>
		</div>

		<div class="col-12 flex-a d-none" id="div-error">
			<div class="alert alert-danger" role="alert">
			  <span id="error-msg"><span>
			  
			</div>
		</div>

		<div class="row flex-a col-12">
			<button type="button" class="btn btn-info btn-start" onclick="generateList()">Iniciar</button>
		</div>

		<select id="fake-select" style="display:none">
			<option selected value="0"></option>
			<option id="bubble-sort" value="1"></option>
			<option id="merge-sort" value="2"></option>
		</select>
	</div>

	<div class="container"  id="div-sort-bubble">
		<div class="col-12 flex-a select-title mt-5" style="font-size:42px;">Bubble Sort</div>
		<div class="row flex-a col-12 my-5" id="row-sort-bubble">
			<div class="row flex-a col-12 my-1" id="bubble-pre"> </div>
		</div>
		<div class="row flex-a col-12 my-5" id="row-sort-bubble">
			<a id="pause-icon-bubble" style="cursor:pointer;" onclick="pause()"><svg style="fill:white;" width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-pause-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  				<path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"/>
			</svg></a>
		<a onclick="pause()" style="display:none;" id="play-icon-bubble">
			<svg style="fill:white;" xmlns="http://www.w3.org/2000/svg" height="3em" viewBox="0 0 24 24" width="3em"><path d="M0 0h24v24H0z" fill="none"/><path d="M8 5v14l11-7z"/></svg>
		</a>
			<a><svg style="fill:white;" width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-shuffle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
			  <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"/>
			  <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"/>
			</svg></a>
			<a style="cursor:pointer;" onclick="backToMain()"><svg style="fill:white;" width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-backspace-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
			  <path fill-rule="evenodd" d="M15.683 3a2 2 0 0 0-2-2h-7.08a2 2 0 0 0-1.519.698L.241 7.35a1 1 0 0 0 0 1.302l4.843 5.65A2 2 0 0 0 6.603 15h7.08a2 2 0 0 0 2-2V3zM5.829 5.854a.5.5 0 1 1 .707-.708l2.147 2.147 2.146-2.147a.5.5 0 1 1 .707.708L9.39 8l2.146 2.146a.5.5 0 0 1-.707.708L8.683 8.707l-2.147 2.147a.5.5 0 0 1-.707-.708L7.976 8 5.829 5.854z"/>
			</svg></a>
		</div>
		<br/>
		<div id="row-sort-bubble-text">
		</div>
	</div>

	<div class="container"  id="div-sort-merge">
		<div class="col-12 flex-a select-title mt-5" style="font-size:42px;">Merge Sort</div>
		<div class="row flex-a col-12 my-5" id="row-sort-merge">

		</div>
		<div id="row-sort-merge-sorted">
		</div>
		<div class="row flex-a col-12 my-5" id="row-sort-bubble">
			<a id="pause-icon-bubble" style="cursor:pointer;" onclick="pause()"><svg style="fill:white;" width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-pause-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
  				<path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5zm5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5z"/>
			</svg></a>
		<a onclick="pause()" style="display:none;" id="play-icon-bubble">
			<svg style="fill:white;" xmlns="http://www.w3.org/2000/svg" height="3em" viewBox="0 0 24 24" width="3em"><path d="M0 0h24v24H0z" fill="none"/><path d="M8 5v14l11-7z"/></svg>
		</a>
			<a><svg style="fill:white;" width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-shuffle" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
			  <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.624 9.624 0 0 0 7.556 8a9.624 9.624 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.595 10.595 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.624 9.624 0 0 0 6.444 8a9.624 9.624 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5z"/>
			  <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192zm0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192z"/>
			</svg></a>
			<a style="cursor:pointer;" onclick="backToMain()"><svg style="fill:white;" width="3em" height="3em" viewBox="0 0 16 16" class="bi bi-backspace-fill" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
			  <path fill-rule="evenodd" d="M15.683 3a2 2 0 0 0-2-2h-7.08a2 2 0 0 0-1.519.698L.241 7.35a1 1 0 0 0 0 1.302l4.843 5.65A2 2 0 0 0 6.603 15h7.08a2 2 0 0 0 2-2V3zM5.829 5.854a.5.5 0 1 1 .707-.708l2.147 2.147 2.146-2.147a.5.5 0 1 1 .707.708L9.39 8l2.146 2.146a.5.5 0 0 1-.707.708L8.683 8.707l-2.147 2.147a.5.5 0 0 1-.707-.708L7.976 8 5.829 5.854z"/>
			</svg></a>
		</div>
		<br/>
		<div id="row-sort-merge-text">
		</div>
	</div>
	
<script type="text/javascript">
	$(document).ready(() => {
		$("#div-sort-merge").hide();
		$("#div-sort-bubble").hide();
		idMap = new Map();
		locked = false;
		locked_id = 0;
		changed = [];
		locked_list = new Map();
		current_left = '';
		current_right = '';
		merge_steps = [];
		steps = [];
		can = false;
		done = false;
		list_aux = [];
	});

	clicked = (value) => {
		bubble = document.getElementById("img-bubble");
		merge = document.getElementById("img-merge");
		if(value == 1){
			merge.className = "img-fluid";
			bubble.className = "img-fluid selected-sort";
		} else if(value == 2) {
			bubble.className = "img-fluid";
			merge.className = "img-fluid selected-sort";
		}
		document.getElementById("fake-select").value = value;

	}

	animatedBubble = (sn1,sn2) => {
		n1 = parseInt(sn1);
		n2 = parseInt(sn2);

		console.log("change " + n1 + " -> " + n2);
		id1 = idMap.get(sn1);
		id2 = idMap.get(sn2);
      	// setTimeout(function (){ $("#n-"+id1).css("background-color",old_color);$("#n-"+id2).css("background-color",old_color)},2200)

      	console.log("change id " + id1 + " -> "+id2)
		var changing_color = '#de4949';
		var old_color = '#86ecfb';

		$("#n-"+id1).stop()
	      .css("background-color",changing_color)
	      .hide(400, function() {
	          $("#n-"+id1).css("background-color",changing_color)
	          $("#n-"+id1).text(n2)
	          // $("#n-"+id1).attr("id","#n-"+id2)
	            .show(1000)
	      }).show(1500,function() {$("#n-"+id1).css("background-color",old_color)});

	    $("#n-"+id2).stop()
	      .css("background-color",changing_color)
	      .hide(400, function() {
	          $("#n-"+id2).css("background-color",changing_color)
	          $("#n-"+id2).text(n1)
	          // $("#n-"+id2).attr("id","#n-"+id1)
            	.show(1000)
	      }).show(1500,function() {$("#n-"+id2).css("background-color",old_color)});

	      var html = "<div class='clear-msg-change' align='center'><p style='font-size:42px;color:white;'><b>Trocando " + n1 + " por " + n2 + "</b></p><div>"; 
	      $('.clear-msg-change').remove();
	      $("#row-sort-bubble-text").append(html);
	}

	changePosition = (id1,id2) => {
		// i1 = '#n-'+id1;
		// i2 = 'n-'+id2;
		var i1 = "#n-"+idMap.get(id1);
		var i2 = "n-"+idMap.get(id2);
		console.log("change "+id1+" <=> "+id2);
		$(i1).swap({  
            target: i2, // Mandatory. The ID of the element we want to swap with  
            opacity: "0.5", // Optional. If set will give the swapping elements a translucent effect while in motion  
            speed: 1000, // Optional. The time taken in milliseconds for the animation to occur  
            callback: function() { // Optional. Callback function once the swap is complete  
                console.log(("Swap Complete"));
            }  
        });
         var html = "<div class='clear-msg-change-pre' align='center'><p style='width: auto;font-size:20px;color:white;'><b>" + $(i1).text() + "⇔" + $("#"+i2).text() + "</b></p><div>"; 
      	 $('.clear-msg-change-pre').remove();
	     $("#bubble-pre").append(html);
	}

	backToMain = () => {
			var exit = confirm("Tem certeza que deseja sair?");

			if (exit) {
				document.location.reload(true);
			}
	}

	doAnimation = (list,i,size) => {
		if(locked) {
		  var html = "<div class='clear-msg-change' align='center'><p style='font-size:42px;color:white;'><b>Pausado</b></p><div>"; 
	      $('.clear-msg-change').remove();
	      $("#row-sort-bubble-text").append(html);
	      locked_id = i;
	      locked_list = list;
	      return;
		}

		if (i < size) {
			setTimeout(function (){
				if (typeof(list[i]) != "object") {
					if (list[i].charAt(0) == "C") {
						var number = list[i].split("/");
						var idx = idMap.get(number.slice(-1)[0]);
						console.log(idx);
						console.log(number);
						$("#n-"+idx).css("background-color","#3cd070");
					}
				} else {
					var n1 = list[i].get("n1");
					var n2 = list[i].get("n2");

					// var number1 = $("#n-"+list[i].get("n1")).text();
					// var number2 = $("#n-"+list[i].get("n2")).text();
					changePosition(n1,n2);

					// animatedBubble(number1,number2);
					
					// id1 = idMap.get(number1);
					// id2 = idMap.get(number2);
					// $("#n-"+id1).attr("id","n-"+id2);
					// $("#n-"+id2).attr("id","n-"+id1);

					// idMap.set(number1,id2);
					// idMap.set(number2,id1);

				}

				doAnimation(list,i+1,size);
			},2000);
		} else {
		  var html = "<div class='clear-msg-change' align='center'><p style='font-size:42px;color:white;'><b>Ordenado</b></p><div>"; 
	      $('.clear-msg-change').remove();
	      $("#row-sort-bubble-text").append(html);
		}
	}

	getAllIndexes = (arr, val) => {
    var indexes = [], i = -1;
    while ((i = arr.indexOf(val, i+1)) != -1){
        indexes.push(i);
    }
    return indexes;
}

	getN = (searched,n) => {
		var i1 = getAllIndexes(list,searched);
		var i2 = getAllIndexes(list,n);
		
		var dist = 10000000000;
		var res = 0;
	
		Object.entries(i1).forEach(([key, value]) => {
   			var temp = Math.abs(parseInt(i2[0]) - parseInt(value));
   			if (temp < dist && value < i2[0]) {
   				dist = temp;
   				res = key;
   			}
		});

		pos_fixed = "-".repeat(res)
		r = searched + pos_fixed
		return r;
	}

	getNK = (n1,n2) => {
		// changed = ["3-1","2-1","3-1"];
		var v = n1.toString() + "/" + n2.toString();
		var count = 0;
		console.log(v);

		changed.forEach((i) => {
			console.log(i);
			if (i == v) {
				count++;
			}
		});
		changed.push(v);
		var s = n2;

		for (var i = 0; i <= count; i++) {
				s += "-";
		};


		console.log("count "+count);
		console.log("s "+s);
		return String(s.slice(0,-1));
	}

	getNumberKey = (n,j) => {	
		var idx = 1;
		var val = n;
		print("idx "+n)
		idMap.forEach((k,i) => {
			if (i == n && idx == j) {
				
				val = i;

			}

			if (i == n) {
				n += "-";
				idx++;
			}
		});

		return val;
	}

  mergeSort = (l0) => {
 
  if (l0.length <= 1) {
    return l0;
  }

  l0 = l0.map(function (x) { 
  	return parseInt(x); 
	});

  const middle = Math.floor(l0.length / 2);

  const left = l0.slice(0, middle);
  const right = l0.slice(middle);

 
  return doMergeSort(
    mergeSort(left), mergeSort(right)
  );
}

genareteMerge = (array,array2,idx) => {
  if (array.length < 1) {
    return array;
  }
  // genareteMerge([4,3,2,1],[],0);
  array = array.map(function (x) { 
  	return parseInt(x); 
  });

  const middle = Math.floor(array.length / 2);
  const middle2 = Math.floor(array2.length / 2);

  const left = array.slice(0, middle);
  const right = array.slice(middle);

  const left2 = array2.slice(0, middle2);
  const right2 = array2.slice(middle2);

  if (idx > 0) {
  	 var tp_map = new Map();
	  tp_map.set("l",array);
	  tp_map.set("r",array2);
	  merge_steps.push(tp_map);
  }
  genareteMerge(left,right,++idx);
  genareteMerge(left2,right2,++idx);
}

joinMerge = () => {
	var a = [];
	var l = [];
	var r = [];
	// genareteMerge([4,3,2,1],[],0);
	
	merge_steps.forEach((p) => {
		var lt = p.get("l");
		var rt = p.get("r");
		for (var i = 0; i < lt.length - 1; i++) {
			for (var j = 1; j <= lt.length - 1; j = j + 2) {

				 l = [Math.min(parseInt(lt[i]),parseInt(lt[j])),Math.max(parseInt(lt[i]),parseInt(lt[j]))];
			};
		};
		for (var i = 0; i < rt.length - 1; i++) {
			for (var j = 1; j <= rt.length - 1; j = j + 2) {

				 r = [Math.min(parseInt(rt[i]),parseInt(rt[j])),Math.max(parseInt(rt[i]),parseInt(rt[j]))];
			};
		};
	});
	a.push(l)
	a.push(r)

	if (l[0] <= r[0]) {
		var aux = [...l,...r];
	} else {
		var aux = [...r,...l];
	}

	list_aux = aux;

	// sorted = aux;

	// var idx = 0;
	// console.log(aux)
	// while (aux.length > 0) {
	// 	var b = [Math.min(parseInt(aux[idx]),parseInt(aux[idx+2])),Math.max(parseInt(aux[idx]),parseInt(aux[idx+2]))];
		
	// 	if(aux[idx+1] == undefined) {
	// 		b = [aux[idx]];
	// 	}

	// 	a.push(b);
	// 	aux.pop(idx);
	// 	aux.pop(idx+2);
	// 	isSorted = arraysEqual()
	// 	if()
	// }

	// console.log(aux);
	// for (var i = 0; i <= aux.length - 1; i++) {
	// 	var j = i + 1;
	// 	if(aux[j] != undefined) {
	// 		if(aux[i] >= aux[j]) {
	// 			var temp = aux[i];
	// 			aux[i] = aux[j];
	// 			aux[j] = aux[i];
	// 		}
	// 		// c = countArrayInArray(a,[aux[i],aux[j]]);
	// 		// console.log("CONTADOR => "+c)
	// 		a.push([aux[i],aux[j]]);
	// 	}
		
	// }


	steps = a;
}

arraysEqual = (a, b) => {
  if (a === b) return true;
  if (a == null || b == null) return false;
  if (a.length !== b.length) return false;

  // If you don't care about the order of the elements inside
  // the array, you should sort both arrays here.
  // Please note that calling sort on an array will modify that array.
  // you might want to clone your array first.

  for (var i = 0; i < a.length; ++i) {
    if (a[i] !== b[i]) return false;
  }
  return true;
}

countArrayInArray = (array,i) => {
	var c = 0;
	array.forEach((j) => {
		// console.log(j)
		// console.log(i)
		// console.log(arraysEqual(j,i))
		// console.log("//")
		if(arraysEqual(j,i)) {
				c += 1;
		}
	});
	return c;
}


 doMergeSort = (left, right) => {
	  let resultArray = [], leftIndex = 0, rightIndex = 0;
	  var tp_map = new Map();
	  tp_map.set("l",left);
	  tp_map.set("r",right);
	  console.log(tp_map);
	  merge_steps.push(tp_map);

	  while (leftIndex < left.length && rightIndex < right.length) {
	    if (left[leftIndex] < right[rightIndex]) {
	      resultArray.push(left[leftIndex]);
	      leftIndex++; 
	    } else {
	      resultArray.push(right[rightIndex]);
	      rightIndex++; 
	    }
	  }
	   return resultArray
	          .concat(left.slice(leftIndex))
	          .concat(right.slice(rightIndex));
	}

	bubbleSort = (list) => {
		console.log(list)
	    let len = list.length;
	    array = [];
	    debug = [];
	    end = [];
	    aux = [];
    	id_ord = 0

	    for (let i = 0; i < len; i++) {
	        for (let j = 0; j < len - id_ord; j++) {
	            if (parseInt(list[j]) > parseInt(list[j + 1])) {
	    			var map = new Map();
	    			var m = new Map();
	    			p1 = j;
	    			p2 = j+1;
	            	var n1 = list[j];
	            	var n2 = list[j+1];
	                var tmp = list[j];
	                list[j] = list[j + 1];
	                list[j + 1] = tmp;

	                var count1 = countElements(list,n1);
	                var count2 = countElements(list,n2);

	                if (count1 > 1) {
	                	n1 = getN(n1,n2);
	                }

	                if (count2 > 1) {
	                	n2 = getN(n2,n1);
	                }

	                map.set("n1",idMap.get(n1));
	                map.set("n2",idMap.get(n2));
	                m.set("n1",n1);
	                m.set("n2",n2);
	                array.push(map);
	                debug.push(m);
	                
	            }

	        }
	        ix = (i+1) * -1;
	        c_c = "C/"+list.slice(ix)[0];
	        
	        n_c = countElements(aux,c_c);
	        
	        if (n_c > 0) {
	        	c_c += "-".repeat(n_c);
	        }

	        debug.push(c_c);
	        aux.push(c_c);
            end.push(list.slice(ix)[0]);
	        id_ord++;
	    }
	    
	    // console.log(end)
	    // console.log("------")
	    // console.log(list);
	    // console.log(idMap)
	    // console.log(array)
	    // console.log(debug)
	    doAnimation(debug,0,debug.length);

	    return list;
	};

	doMerge = (i) => {
			id_l = makeid(5);
			empty_l = false;

			if(current_left == '') {
				empty_l = true;
			}

			old = current_left;
			current_left = id_l;

			var html = "<div class='row flex-b col-12 my-5' id="+current_left+">";


			if(typeof(i) == "object") {
				
				if (i.has("l")) {
					html += "<div>";
					i.get("l").forEach((j) => {
					html += "<div class='number-item merged-item' align='left' style='float:left'>";
					html += "<div class='card-body'>" + j + "</div>";
					html += "</div>";

					});
					html += "</div>";
				} 
				

				if (i.has("r")) {
					html += "<div>";
					i.get("r").forEach((j) => {
						html += "<div class='number-item merged-item' align='right' style='float:right'>";
						html += "<div class='card-body'>" + j + "</div>";
						html += "</div>";
					});
					html += "</div>";
				}
				
				if (empty_l) {
					old = 'row-sort-merge';
				}


				id_elemento = "#"+old;
				console.log(id_elemento)
				$(html).insertAfter( $(id_elemento));
				// var br = "<br/>";
				// $(br).insertAfter( $("#row-sort-merge" ));
			}
	}

	showMerged = (array) => {
		console.log("#"+current_left)
		$("#"+current_left).remove();
		var html = "<div class='row flex-a col-12 my-5' id="+'merged-id'+">";
		array.forEach((i) => {
			html += "<div class='number-item merged'>";
			html += "<div class='card-body'>" + i + "</div>";
			html += "</div>";
		});
		html += "</div>";
		console.log("#"+current_left)
		$("#row-sort-merge-sorted").append(html);
		// $(html).insertAfter( $("#"+current_left));
	};

	startMerge = (merge_list,i,size,merged) => {
		if(locked) {
		  var html = "<div class='clear-msg-change row flex-a col-12 my-5' align='center'><p style='font-size:42px;color:white;'><b>Pausado</b></p><div>"; 
	      $('.clear-msg-change').remove();
	      $("#row-sort-bubble-text").append(html);
	      locked_id = i;
	      locked_list = list;
	      return;
		}
		console.log("size => "+size)
		if (size > 0) {
				setTimeout(function (){doMerge(merge_list[size]);startMerge(merge_list,++i,--size,merged);},2000);
		 	} else {
			  showMerged(merged);
			  var html = "<div class='clear-msg-change' align='center'><p style='font-size:42px;color:white;'><b>Ordenado</b></p><div>"; 
		      $('.clear-msg-change').remove();
		      $("#row-sort-merge-text").append(html);
		   // setTimeout(function (){startMerge2(steps,0,steps.length,merged)},500);
		}
	}

	doMerge2 = (i) => {
		id_l = makeid(5);

		empty_l = false;

		if(current_left == '') {
			empty_l = true;
		}

		old = current_left;
		current_left = id_l;
		console.log("cl =. " + current_left);

		var html = "<div class='row flex-a col-12 my-5' id="+current_left+">";


		i.forEach((j) => {
			html += "<div class='number-item merged-item'>";
			html += "<div class='card-body'>" + j + "</div>";
			html += "</div>";
		});

		if (empty_l) {
					old = 'row-sort-merge';
		}

		id_elemento = "#"+old;
		$(html).insertAfter( $(id_elemento));
	}

	function separar(base, max) {
	  var res = [];
	  
	  for (var i = 0; i < base.length; i = i+(max-1)) {
	    res.push(base.slice(i,(i+max)));
	  }
	  res[res.length-1].push(base[0]);
	  return res;
	}

	function arr_diff (a1, a2) {

	    var a = [], diff = [];

	    for (var i = 0; i < a1.length; i++) {
	        a[a1[i]] = true;
	    }

	    for (var i = 0; i < a2.length; i++) {
	        if (a[a2[i]]) {
	            delete a[a2[i]];
	        } else {
	            a[a2[i]] = true;
	        }
	    }

	    for (var k in a) {
	        diff.push(k);
	    }

	    return diff;
	}

	startMerge2 = (merge_list,i,size,merged) => {
		id_l = makeid(5);

		empty_l = false;

		if(current_left == '') {
			empty_l = true;
		}

		old = current_left;
		current_left = id_l;
		console.log("cl =. " + current_left);

		var html = "<div class='row flex-a col-12 my-5' id="+current_left+">";


		// merge_list.forEach((j) => {
		// 	console.log("--ad--")
		// 	console.log(j)
		// 	console.log("--ed--")
		// 	j.forEach((k) => {
		// 		html += "<div class='number-item merged-item'>";
		// 	html += "<div class='card-body'>" + k+ "</div>";
		// 	html += "</div>";
		// 	})
			
		// });

		html += "</div>";

		aux = [];
		idx = 2;
		nn = [];
		while (idx <= merged.length) {
			n_a = separar(list_aux,idx);
			aux = [...aux,...n_a];
			nn.push(n_a);
			idx++;
		}



		if (empty_l) {
			old = 'row-sort-merge';
		}

		id_elemento = "#"+old;
		$(html).insertAfter( $(id_elemento));

		setTimeout(function (){
			var old = current_left;
			var tt = "<div class='row flex-a col-12 my-5'>";
			console.log("nnnn");
			console.log(nn)
			idx_aux = 0;
			nn[0].forEach((k) => {
				console.log("j0 -->" +k[0])
				tt += "<div class='number-item merged-item'>";
				tt += "<div class='card-body'>" + k[0] + "</div></div>";
				idx_aux++;

			});

			tt += "</div>";

			// for (var i = 1; i < nn.length; i++) {
			// 	current_left = makeid(5);
			// 	var tt = "<div class='row flex-a col-12 my-5' id="+current_left+">";
			// 	nn[i][0].forEach((x) => {
			// 	tt += "<div>";
			// 	tt += "<div class='number-item merged-item'>";
			// 	tt += "<div class='card-body'>" + x + "</div>";
			// 	tt += "</div>";
			// 	})
			// 	tt += "</div>";
			// };

			var id_elemento = "#"+old;
			$(html).insertAfter( $(id_elemento));
			$(tt).insertAfter( $(id_elemento));
			setTimeout(function (){showMerged(merged)},700);
		},1500);

	}

	// startMerge2 = (merge_list,i,size,merged) => {
	// 	if(locked) {
	// 	  var html = "<div class='clear-msg-change row flex-a col-12 my-5' align='center'><p style='font-size:42px;color:white;'><b>Pausado</b></p><div>"; 
	//       $('.clear-msg-change').remove();
	//       $("#row-sort-bubble-text").append(html);
	//       locked_id = i;
	//       locked_list = list;
	//       return;
	// 	}
		
	// 	if (i < size) {
	// 		console.log(merge_list[i])
	// 			setTimeout(function (){doMerge2(merge_list[i]);startMerge2(merge_list,++i,size,merged);},2000);
	// 		} else {
	// 		  done = true;		      
	// 		  showMerged(merged);
	// 		  var html = "<div class='clear-msg-change' align='center'><p style='font-size:42px;color:white;'><b>Ordenado</b></p><div>"; 
	// 	      $('.clear-msg-change').remove();
	// 	      $("#row-sort-merge-text").append(html);
	// 	}
	// }


	hideMain = () => {
		$("#div-main").hide();
		// document.getElementById("div-main").className = "container d-none";
	}

	showMain = () => {
		$("#div-main").show();
		// document.getElementById("div-main").className = "container";
	}

	hideBubble = () => {
		$("#div-sort-bubble").hide();
		// document.getElementById("div-sort-bubble").className = "container d-none";
	}

	showBubble = (list) => {
		$("#div-sort-bubble").show();
		// document.getElementById("div-sort-bubble").className = "container";
		setTimeout(function (){bubbleSort(list)},500);
	}

	hideMerge = () => {
		$("#div-sort-merge").hide();
		// document.getElementById("div-sort-merge").className = "container d-none";
	}

	showMerge = (list) => {
		$("#div-sort-merge").show();
		var merged = mergeSort(list);
		// joinMerge();
		setTimeout(function (){startMerge(merge_steps,0,merge_steps.length - 1,merged);},500);
		
		// while (!done) {
		// 	if (can) {
		// 		setTimeout(function (){startMerge2(steps,0,steps.length,merged)},500);
		// 	}
		// }
		// document.getElementById("div-sort-merge").className = "container";
	}

	hideError = () => {
		document.getElementById("div-error").className = "container mt-3 d-none";
	}

	showError = () => {
		document.getElementById("div-error").className = "container mt-3";
	}

	addError = (msg) => {
		document.getElementById("error-msg").innerText = msg;
		showError();
	}

	makeid = (length) =>  {
	   var result           = '';
	   var characters       = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
	   var charactersLength = characters.length;
	   for ( var i = 0; i < length; i++ ) {
	      result += characters.charAt(Math.floor(Math.random() * charactersLength));
	   }
	   return result;
	}

	 countElements = (list,element) => {
		var count = 0;
		for(var i = 0; i < list.length; ++i){
		    if(list[i] == element)
		        count++;
		}
		return count;
	}

	hashCode = s => s.split('').reduce((a,b)=>{a=((a<<5)-a)+b.charCodeAt(0);return a&a},0)

	generateList = () => {
		if(document.getElementById("numbers-input").value.length == 0) {
			var msg = "Lista de números não pode ser vazia";
			addError(msg);
			return;
		}

		if(document.getElementById("fake-select").value != 1 && document.getElementById("fake-select").value != 2){
			var msg = "Escolha um algoritmo de ordenação";
			addError(msg);
			return;
		}


		hideMain();
		auxList = [];
		list =  document.getElementById("numbers-input").value.split(',');
		list.forEach((item) => {
			var n = hashCode(makeid(4));
			var child = document.createElement("div");
			var el_id = "id='n-" + String(n) + "'";
			child.className = "number-item";
			var html = '<div ' + el_id + 'class="card-body">'+
			    item +
			  '</div>';
			child.innerHTML = html;

			var id = "row-sort-bubble";
			if(document.getElementById("fake-select").value == 2) {
				id = "row-sort-merge";
			} 
			document.getElementById(id).appendChild(child);

			count = countElements(auxList,item);
			n_item = item;

			if (count >= 1) {
				for (var i = 1; i <= count; i++) {
					item = item + "-";
				};
			}

			auxList.push(n_item);

			idMap.set(item,n);
		})

		if(document.getElementById("fake-select").value == 2) {
			showMerge(list);
		} else {
			showBubble(list);
		}
	
	}

	createChangeList = (l) => {
		l.forEach((i) => {
			changed[i] = [];
		})
	}

	pause = () => {
		if (locked) {
			locked = false;
			$("#play-icon-bubble").hide();
			$("#pause-icon-bubble").show();
			$('.clear-msg-change').remove();
			doAnimation(locked_list,locked_id,locked_list.length);
			return;
		}

		$("#pause-icon-bubble").hide();
		$("#play-icon-bubble").show();
		locked = true;
	}



</script>
</body>
</html>
